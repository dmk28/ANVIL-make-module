{
  "name": "generatePdfMarkdown",
  "label": "Generate PDF from Markdown",
  "description": "Generate a PDF document from Markdown content with support for tables, headings, labels, and styled content.",
  "type": "action",
  "connection": "anvil",
  "communication": {
    "url": "https://graphql.useanvil.com",
    "method": "POST",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
    },
    "body": {
      "query": "mutation GeneratePdf($data: GeneratePdfInput!) { generatePdf(data: $data) { file downloadUrl } }",
      "variables": {
        "data": {
          "type": "markdown",
          "title": "{{parameters.title}}",
          "fontFamily": "{{parameters.fontFamily}}",
          "fontSize": "{{parameters.fontSize}}",
          "textColor": "{{parameters.textColor}}",
          "includeTimestamp": "{{parameters.includeTimestamp}}",
          "data": "{{parameters.contentSections}}",
          "page": {
            "width": "{{parameters.pageWidth}}",
            "height": "{{parameters.pageHeight}}",
            "marginTop": "{{parameters.marginTop}}",
            "marginBottom": "{{parameters.marginBottom}}",
            "marginLeft": "{{parameters.marginLeft}}",
            "marginRight": "{{parameters.marginRight}}"
          },
          "logo": {
            "src": "{{parameters.logoUrl}}",
            "maxWidth": "{{parameters.logoMaxWidth}}"
          }
        }
      }
    },
    "response": {
      "output": {
        "file": "{{body.data.generatePdf.file}}",
        "downloadUrl": "{{body.data.generatePdf.downloadUrl}}",
        "title": "{{parameters.title}}",
        "generatedAt": "{{now}}"
      },
      "error": {
        "message": "{{if(body.errors; body.errors[0].message; if(body.error; body.error; if(body.message; body.message; 'Failed to generate PDF from Markdown'))))}}"
      }
    },
    "log": {
      "sanitize": [
        "request.headers.Authorization"
      ]
    }
  },
  "parameters": [
    {
      "name": "title",
      "label": "Document Title",
      "type": "text",
      "required": false,
      "help": "Title encoded into the PDF metadata",
      "mappable": true
    },
    {
      "name": "contentSections",
      "label": "Content Sections",
      "type": "array",
      "required": true,
      "help": "Array of content sections (labels, content, headings, or tables)",
      "mappable": true,
      "spec": {
        "type": "collection",
        "spec": [
          {
            "name": "type",
            "label": "Section Type",
            "type": "select",
            "required": true,
            "default": "content",
            "options": [
              { "label": "Content (Markdown)", "value": "content" },
              { "label": "Label", "value": "label" },
              { "label": "Heading", "value": "heading" },
              { "label": "Table", "value": "table" }
            ]
          },
          {
            "name": "label",
            "label": "Label Text",
            "type": "text",
            "required": false,
            "help": "Text for label sections"
          },
          {
            "name": "content",
            "label": "Markdown Content",
            "type": "text",
            "required": false,
            "help": "Markdown-formatted text content"
          },
          {
            "name": "heading",
            "label": "Heading Text",
            "type": "text",
            "required": false,
            "help": "Text for heading sections"
          },
          {
            "name": "tableRows",
            "label": "Table Data",
            "type": "array",
            "required": false,
            "help": "Array of row arrays for table data",
            "spec": {
              "type": "array",
              "spec": {
                "type": "text"
              }
            }
          }
        ]
      }
    },
    {
      "name": "fontFamily",
      "label": "Font Family",
      "type": "select",
      "required": false,
      "default": "Roboto",
      "options": [
        { "label": "Roboto (Default)", "value": "Roboto" },
        { "label": "Noto Sans", "value": "Noto Sans" },
        { "label": "Open Sans", "value": "Open Sans" },
        { "label": "Lato", "value": "Lato" },
        { "label": "Helvetica", "value": "Helvetica" }
      ],
      "help": "Font family for the PDF",
      "advanced": true
    },
    {
      "name": "fontSize",
      "label": "Font Size",
      "type": "integer",
      "required": false,
      "default": 12,
      "help": "Base font size for the PDF",
      "advanced": true
    },
    {
      "name": "textColor",
      "label": "Text Color",
      "type": "text",
      "required": false,
      "default": "#333333",
      "help": "Hex color code for text (e.g., #333333)",
      "advanced": true
    },
    {
      "name": "includeTimestamp",
      "label": "Include Timestamp",
      "type": "boolean",
      "required": false,
      "default": false,
      "help": "Show generation timestamp at the bottom of the PDF",
      "advanced": true
    },
    {
      "name": "logoUrl",
      "label": "Logo URL",
      "type": "url",
      "required": false,
      "help": "URL for a logo image to include",
      "advanced": true
    },
    {
      "name": "logoMaxWidth",
      "label": "Logo Max Width",
      "type": "integer",
      "required": false,
      "default": 200,
      "help": "Maximum width for the logo in pixels",
      "advanced": true
    },
    {
      "name": "pageWidth",
      "label": "Page Width",
      "type": "text",
      "required": false,
      "default": "8.5in",
      "help": "Page width with unit (e.g., '8.5in', '210mm')",
      "advanced": true
    },
    {
      "name": "pageHeight",
      "label": "Page Height",
      "type": "text",
      "required": false,
      "default": "11in",
      "help": "Page height with unit (e.g., '11in', '297mm')",
      "advanced": true
    },
    {
      "name": "marginTop",
      "label": "Top Margin",
      "type": "text",
      "required": false,
      "default": "50px",
      "help": "Top margin with unit",
      "advanced": true
    },
    {
      "name": "marginBottom",
      "label": "Bottom Margin",
      "type": "text",
      "required": false,
      "default": "50px",
      "help": "Bottom margin with unit",
      "advanced": true
    },
    {
      "name": "marginLeft",
      "label": "Left Margin",
      "type": "text",
      "required": false,
      "default": "60px",
      "help": "Left margin with unit",
      "advanced": true
    },
    {
      "name": "marginRight",
      "label": "Right Margin",
      "type": "text",
      "required": false,
      "default": "60px",
      "help": "Right margin with unit",
      "advanced": true
    }
  ],
  "interface": [
    {
      "name": "file",
      "label": "PDF File (Base64)",
      "type": "text"
    },
    {
      "name": "downloadUrl",
      "label": "Download URL",
      "type": "url"
    },
    {
      "name": "title",
      "label": "Document Title",
      "type": "text"
    },
    {
      "name": "generatedAt",
      "label": "Generated At",
      "type": "date"
    }
  ]
}
