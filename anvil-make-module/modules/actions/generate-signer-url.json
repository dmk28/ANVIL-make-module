{
  "name": "generateSignerUrl",
  "label": "Generate Signer URL",
  "description": "Generate a signing URL for an embedded signer. Use this when you want to control the signing flow in your own application.",
  "type": "action",
  "connection": "anvil",
  "communication": {
    "url": "https://graphql.useanvil.com",
    "method": "POST",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
    },
    "body": {
      "query": "mutation GenerateEtchSignUrl($signerEid: String!, $clientUserId: String!) { generateEtchSignUrl(signerEid: $signerEid, clientUserId: $clientUserId) { url signerToken } }",
      "variables": {
        "signerEid": "{{parameters.signerEid}}",
        "clientUserId": "{{parameters.clientUserId}}"
      }
    },
    "response": {
      "output": {
        "signUrl": "{{body.data.generateEtchSignUrl.url}}",
        "signerToken": "{{body.data.generateEtchSignUrl.signerToken}}",
        "signerEid": "{{parameters.signerEid}}",
        "clientUserId": "{{parameters.clientUserId}}",
        "generatedAt": "{{now}}"
      },
      "error": {
        "message": "{{if(body.errors; body.errors[0].message; if(body.error; body.error; if(body.message; body.message; 'Failed to generate signer URL'))))}}"
      }
    },
    "log": {
      "sanitize": [
        "request.headers.Authorization"
      ]
    }
  },
  "parameters": [
    {
      "name": "signerEid",
      "label": "Signer ID",
      "type": "text",
      "required": true,
      "help": "The EID of the signer (from Create E-Signature Packet response)",
      "mappable": true
    },
    {
      "name": "clientUserId",
      "label": "Client User ID",
      "type": "text",
      "required": true,
      "help": "Your unique identifier for this user session. Used to associate the signing session with your user.",
      "mappable": true
    }
  ],
  "interface": [
    {
      "name": "signUrl",
      "label": "Sign URL",
      "type": "url"
    },
    {
      "name": "signerToken",
      "label": "Signer Token",
      "type": "text"
    },
    {
      "name": "signerEid",
      "label": "Signer ID",
      "type": "text"
    },
    {
      "name": "clientUserId",
      "label": "Client User ID",
      "type": "text"
    },
    {
      "name": "generatedAt",
      "label": "Generated At",
      "type": "date"
    }
  ]
}
