{
  "name": "downloadDocuments",
  "label": "Download Documents",
  "description": "Download a ZIP file of all completed documents from a signature packet or workflow",
  "type": "action",
  "connection": "anvil",
  "communication": {
    "url": "https://graphql.useanvil.com",
    "method": "POST",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
    },
    "body": {
      "query": "query DocumentGroup($eid: String!) { documentGroup(eid: $eid) { eid status downloadZipURL files { eid filename title downloadUrl } } }",
      "variables": {
        "eid": "{{parameters.documentGroupEid}}"
      }
    },
    "response": {
      "output": {
        "documentGroupEid": "{{body.data.documentGroup.eid}}",
        "status": "{{body.data.documentGroup.status}}",
        "downloadZipURL": "{{body.data.documentGroup.downloadZipURL}}",
        "files": "{{body.data.documentGroup.files}}"
      },
      "error": {
        "message": "{{if(body.errors; body.errors[0].message; 'Failed to get document download URLs')}}"
      }
    },
    "log": {
      "sanitize": [
        "request.headers.Authorization"
      ]
    }
  },
  "parameters": [
    {
      "name": "documentGroupEid",
      "label": "Document Group ID",
      "type": "text",
      "required": true,
      "help": "The EID of the DocumentGroup. You can find this in the output of Create E-Signature Packet or Get Workflow Data.",
      "mappable": true
    }
  ],
  "interface": [
    {
      "name": "documentGroupEid",
      "label": "Document Group ID",
      "type": "text"
    },
    {
      "name": "status",
      "label": "Status",
      "type": "text"
    },
    {
      "name": "downloadZipURL",
      "label": "Download ZIP URL",
      "type": "url"
    },
    {
      "name": "files",
      "label": "Files",
      "type": "array",
      "spec": {
        "type": "collection",
        "spec": [
          {
            "name": "eid",
            "label": "File ID",
            "type": "text"
          },
          {
            "name": "filename",
            "label": "Filename",
            "type": "text"
          },
          {
            "name": "title",
            "label": "Title",
            "type": "text"
          },
          {
            "name": "downloadUrl",
            "label": "Download URL",
            "type": "url"
          }
        ]
      }
    }
  ]
}
