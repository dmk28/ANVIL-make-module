{
  "name": "anvil",
  "label": "Anvil",
  "version": "1.0.0",
  "description": "Anvil API integration for PDF filling, e-signatures, and document workflows. Fill PDF templates, collect e-signatures, and automate document processes.",
  "beta": false,
  "moduleConfig": {
    "limit": 100
  },
  "baseUrl": "https://app.useanvil.com/api/v1",
  "connection": {
    "label": "Anvil API Key",
    "type": "api-key",
    "parameters": [
      {
        "name": "apiKey",
        "type": "password",
        "label": "API Key",
        "required": true,
        "help": "Your Anvil API key. Find it at Organization Settings > API Settings. Use production key for live data or development key for testing.",
        "editable": true
      },
      {
        "name": "environment",
        "type": "select",
        "label": "Environment",
        "required": true,
        "default": "production",
        "options": [
          {
            "label": "Production",
            "value": "production"
          },
          {
            "label": "Development",
            "value": "development"
          }
        ],
        "help": "Production key for live data, Development key for testing (watermarked PDFs, more aggressive rate limits)"
      }
    ],
    "communication": {
      "url": "https://graphql.useanvil.com",
      "method": "POST",
      "headers": {
        "Authorization": "Basic {{base64(parameters.apiKey + ':')}}"
      },
      "body": {
        "query": "{ currentUser { eid email } }"
      },
      "response": {
        "error": {
          "message": "{{if(body.errors; body.errors[0].message; 'Authentication failed')}}"
        }
      },
      "log": {
        "sanitize": [
          "request.headers.Authorization"
        ]
      }
    }
  },
  "base": {
    "baseUrl": "https://app.useanvil.com/api/v1",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
    },
    "response": {
      "error": {
        "message": "{{if(body.error; body.error; if(body.message; body.message; 'Request failed'))}}",
        "type": "{{if(response.statusCode === 401; 'AuthenticationError'; if(response.statusCode === 429; 'RateLimitError'; 'Error'))}}"
      }
    },
    "log": {
      "sanitize": [
        "request.headers.Authorization"
      ]
    }
  },
  "rpc": [],
  "modules": [
    {
      "name": "fillPdfTemplate",
      "label": "Fill a PDF Template",
      "description": "Fill a PDF template with data and return the filled PDF as a file",
      "type": "action",
      "connection": "anvil",
      "communication": {
        "url": "/fill/{{parameters.templateId}}.pdf",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/pdf"
        },
        "body": {
          "title": "{{parameters.title}}",
          "fontFamily": "{{parameters.fontFamily}}",
          "fontSize": "{{parameters.fontSize}}",
          "textColor": "{{parameters.textColor}}",
          "alignment": "{{parameters.alignment}}",
          "useInteractiveFields": "{{parameters.useInteractiveFields}}",
          "data": "{{parameters.data}}"
        },
        "response": {
          "output": {
            "file": "{{body}}",
            "fileName": "{{if(parameters.outputFileName; parameters.outputFileName; 'filled-document.pdf')}}",
            "contentType": "application/pdf",
            "templateId": "{{parameters.templateId}}",
            "title": "{{parameters.title}}"
          },
          "error": {
            "message": "{{if(body.name === 'ValidationError'; 'Validation Error: ' + body.fields[0].message; if(body.message; body.message; 'Failed to fill PDF template'))}}"
          }
        },
        "options": {
          "response": {
            "encoding": "buffer"
          }
        }
      },
      "parameters": [
        {
          "name": "templateId",
          "label": "PDF Template ID",
          "type": "text",
          "required": true,
          "help": "The ID of the PDF template to fill. Find this in Anvil under your template's API information.",
          "mappable": true
        },
        {
          "name": "data",
          "label": "Fill Data",
          "type": "json",
          "required": true,
          "help": "JSON object with field aliases as keys and values to fill. Example: `{\"name\": \"John Doe\", \"email\": \"john@example.com\"}`",
          "mappable": true
        },
        {
          "name": "title",
          "label": "Document Title",
          "type": "text",
          "required": false,
          "help": "Title encoded into the PDF document metadata",
          "advanced": true,
          "mappable": true
        },
        {
          "name": "outputFileName",
          "label": "Output File Name",
          "type": "filename",
          "required": false,
          "default": "filled-document.pdf",
          "help": "Name for the output PDF file",
          "advanced": true
        },
        {
          "name": "fontFamily",
          "label": "Font Family",
          "type": "select",
          "required": false,
          "default": "Noto Sans",
          "options": [
            { "label": "Noto Sans (Default)", "value": "Noto Sans" },
            { "label": "Roboto", "value": "Roboto" },
            { "label": "Open Sans", "value": "Open Sans" },
            { "label": "Lato", "value": "Lato" },
            { "label": "Courier", "value": "Courier" },
            { "label": "Helvetica", "value": "Helvetica" },
            { "label": "Times New Roman", "value": "Times New Roman" }
          ],
          "help": "Font family for filled text fields",
          "advanced": true
        },
        {
          "name": "fontSize",
          "label": "Font Size",
          "type": "integer",
          "required": false,
          "default": 10,
          "help": "Font size for filled text",
          "advanced": true
        },
        {
          "name": "textColor",
          "label": "Text Color",
          "type": "color",
          "required": false,
          "default": "#3E3E57",
          "help": "Hex color code for filled text",
          "advanced": true
        },
        {
          "name": "alignment",
          "label": "Text Alignment",
          "type": "select",
          "required": false,
          "default": "left",
          "options": [
            { "label": "Left", "value": "left" },
            { "label": "Center", "value": "center" },
            { "label": "Right", "value": "right" }
          ],
          "help": "Text alignment for filled fields",
          "advanced": true
        },
        {
          "name": "useInteractiveFields",
          "label": "Use Interactive Fields",
          "type": "boolean",
          "required": false,
          "default": false,
          "help": "When enabled, filled fields remain editable in PDF readers",
          "advanced": true
        }
      ],
      "interface": [
        {
          "name": "file",
          "label": "PDF File",
          "type": "buffer",
          "semantic": "file:data"
        },
        {
          "name": "fileName",
          "label": "File Name",
          "type": "filename",
          "semantic": "file:name"
        },
        {
          "name": "contentType",
          "label": "Content Type",
          "type": "text"
        },
        {
          "name": "templateId",
          "label": "Template ID",
          "type": "text"
        },
        {
          "name": "title",
          "label": "Document Title",
          "type": "text"
        }
      ]
    },
    {
      "name": "listPdfTemplates",
      "label": "List PDF Templates",
      "description": "Retrieve a list of all PDF templates (Casts) in your organization",
      "type": "search",
      "connection": "anvil",
      "communication": {
        "url": "https://graphql.useanvil.com",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
        },
        "body": {
          "query": "query { currentUser { organizations { eid name slug casts { eid name createdAt updatedAt isArchived versionNumber } } } }"
        },
        "response": {
          "iterate": "{{body.data.currentUser.organizations[0].casts}}",
          "output": {
            "eid": "{{item.eid}}",
            "name": "{{item.name}}",
            "createdAt": "{{item.createdAt}}",
            "updatedAt": "{{item.updatedAt}}",
            "isArchived": "{{item.isArchived}}",
            "versionNumber": "{{item.versionNumber}}"
          },
          "error": {
            "message": "{{if(body.errors; body.errors[0].message; 'Failed to list PDF templates')}}"
          }
        },
        "log": {
          "sanitize": [
            "request.headers.Authorization"
          ]
        }
      },
      "parameters": [],
      "interface": [
        {
          "name": "eid",
          "label": "Template ID",
          "type": "text"
        },
        {
          "name": "name",
          "label": "Template Name",
          "type": "text"
        },
        {
          "name": "createdAt",
          "label": "Created At",
          "type": "date"
        },
        {
          "name": "updatedAt",
          "label": "Updated At",
          "type": "date"
        },
        {
          "name": "isArchived",
          "label": "Is Archived",
          "type": "boolean"
        },
        {
          "name": "versionNumber",
          "label": "Version Number",
          "type": "integer"
        }
      ]
    },
    {
      "name": "createEsignaturePacket",
      "label": "Create an E-Signature Packet",
      "description": "Create an e-signature packet with PDFs and signers",
      "type": "action",
      "connection": "anvil",
      "communication": {
        "url": "https://graphql.useanvil.com",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
        },
        "body": {
          "query": "mutation CreateEtchPacket($variables: CreateEtchPacketInput!) { createEtchPacket(variables: $variables) { eid name status isTest isDraft createdAt documentGroup { eid status downloadZipURL signers { eid name email status signerType routingOrder } } signers { eid name email status signerType routingOrder } } }",
          "variables": {
            "variables": {
              "name": "{{parameters.packetName}}",
              "isDraft": "{{parameters.isDraft}}",
              "isTest": "{{parameters.isTest}}",
              "signatureEmailSubject": "{{parameters.emailSubject}}",
              "files": "{{parameters.files}}",
              "data": {
                "payloads": "{{parameters.fillData}}"
              },
              "signers": "{{parameters.signers}}"
            }
          }
        },
        "response": {
          "output": {
            "packetEid": "{{body.data.createEtchPacket.eid}}",
            "name": "{{body.data.createEtchPacket.name}}",
            "status": "{{body.data.createEtchPacket.status}}",
            "isTest": "{{body.data.createEtchPacket.isTest}}",
            "isDraft": "{{body.data.createEtchPacket.isDraft}}",
            "createdAt": "{{body.data.createEtchPacket.createdAt}}",
            "documentGroup": "{{body.data.createEtchPacket.documentGroup}}",
            "signers": "{{body.data.createEtchPacket.signers}}"
          },
          "error": {
            "message": "{{if(body.errors; body.errors[0].message; 'Failed to create e-signature packet')}}"
          }
        },
        "log": {
          "sanitize": [
            "request.headers.Authorization"
          ]
        }
      },
      "parameters": [
        {
          "name": "packetName",
          "label": "Packet Name",
          "type": "text",
          "required": true,
          "help": "A descriptive name for this signature packet",
          "mappable": true
        },
        {
          "name": "isDraft",
          "label": "Save as Draft",
          "type": "boolean",
          "required": false,
          "default": false,
          "help": "If true, the packet will be saved as a draft and not sent to signers"
        },
        {
          "name": "isTest",
          "label": "Test Mode",
          "type": "boolean",
          "required": false,
          "default": true,
          "help": "If true, signatures will be demo (not legally binding) and PDFs will be watermarked"
        },
        {
          "name": "files",
          "label": "PDF Files",
          "type": "array",
          "required": true,
          "help": "Array of file objects referencing templates",
          "mappable": true,
          "spec": {
            "type": "collection",
            "spec": [
              {
                "name": "id",
                "label": "File ID",
                "type": "text",
                "required": true,
                "help": "Unique identifier for this file"
              },
              {
                "name": "castEid",
                "label": "Template ID",
                "type": "text",
                "required": true,
                "help": "ID of the PDF template"
              },
              {
                "name": "filename",
                "label": "File Name",
                "type": "text",
                "required": false,
                "help": "Custom filename for the generated PDF"
              }
            ]
          }
        },
        {
          "name": "signers",
          "label": "Signers",
          "type": "array",
          "required": true,
          "help": "Array of signer objects",
          "mappable": true,
          "spec": {
            "type": "collection",
            "spec": [
              {
                "name": "id",
                "label": "Signer ID",
                "type": "text",
                "required": true,
                "help": "Unique identifier for this signer"
              },
              {
                "name": "name",
                "label": "Name",
                "type": "text",
                "required": true,
                "help": "Full name of the signer"
              },
              {
                "name": "email",
                "label": "Email",
                "type": "email",
                "required": true,
                "help": "Email address of the signer"
              },
              {
                "name": "signerType",
                "label": "Signer Type",
                "type": "select",
                "required": false,
                "default": "email",
                "options": [
                  { "label": "Email (Anvil sends)", "value": "email" },
                  { "label": "Embedded (You control)", "value": "embedded" }
                ]
              },
              {
                "name": "routingOrder",
                "label": "Routing Order",
                "type": "integer",
                "required": false,
                "default": 1
              },
              {
                "name": "fields",
                "label": "Signature Fields",
                "type": "array",
                "required": true,
                "spec": {
                  "type": "collection",
                  "spec": [
                    {
                      "name": "fileId",
                      "label": "File ID",
                      "type": "text",
                      "required": true
                    },
                    {
                      "name": "fieldId",
                      "label": "Field ID",
                      "type": "text",
                      "required": true
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "name": "fillData",
          "label": "Fill Data",
          "type": "json",
          "required": false,
          "help": "JSON object mapping file IDs to fill data",
          "advanced": true,
          "mappable": true
        },
        {
          "name": "emailSubject",
          "label": "Email Subject",
          "type": "text",
          "required": false,
          "help": "Custom subject for signing request emails",
          "advanced": true,
          "mappable": true
        }
      ],
      "interface": [
        {
          "name": "packetEid",
          "label": "Packet ID",
          "type": "text"
        },
        {
          "name": "name",
          "label": "Packet Name",
          "type": "text"
        },
        {
          "name": "status",
          "label": "Status",
          "type": "text"
        },
        {
          "name": "isTest",
          "label": "Is Test",
          "type": "boolean"
        },
        {
          "name": "isDraft",
          "label": "Is Draft",
          "type": "boolean"
        },
        {
          "name": "createdAt",
          "label": "Created At",
          "type": "date"
        },
        {
          "name": "documentGroup",
          "label": "Document Group",
          "type": "collection",
          "spec": [
            {
              "name": "eid",
              "type": "text"
            },
            {
              "name": "status",
              "type": "text"
            },
            {
              "name": "downloadZipURL",
              "type": "url"
            }
          ]
        },
        {
          "name": "signers",
          "label": "Signers",
          "type": "array",
          "spec": {
            "type": "collection",
            "spec": [
              {
                "name": "eid",
                "type": "text"
              },
              {
                "name": "name",
                "type": "text"
              },
              {
                "name": "email",
                "type": "email"
              },
              {
                "name": "status",
                "type": "text"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "sendDraftPacket",
      "label": "Send a Draft E-Signature Packet",
      "description": "Send a draft e-signature packet to its signers",
      "type": "action",
      "connection": "anvil",
      "communication": {
        "url": "https://graphql.useanvil.com",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
        },
        "body": {
          "query": "mutation SendEtchPacket($eid: String!) { sendEtchPacket(eid: $eid) { eid name status isDraft createdAt documentGroup { eid status signers { eid name email status } } } }",
          "variables": {
            "eid": "{{parameters.packetEid}}"
          }
        },
        "response": {
          "output": {
            "packetEid": "{{body.data.sendEtchPacket.eid}}",
            "name": "{{body.data.sendEtchPacket.name}}",
            "status": "{{body.data.sendEtchPacket.status}}",
            "isDraft": "{{body.data.sendEtchPacket.isDraft}}",
            "createdAt": "{{body.data.sendEtchPacket.createdAt}}",
            "documentGroup": "{{body.data.sendEtchPacket.documentGroup}}"
          },
          "error": {
            "message": "{{if(body.errors; body.errors[0].message; 'Failed to send draft packet')}}"
          }
        },
        "log": {
          "sanitize": [
            "request.headers.Authorization"
          ]
        }
      },
      "parameters": [
        {
          "name": "packetEid",
          "label": "Packet ID",
          "type": "text",
          "required": true,
          "help": "The EID of the draft e-signature packet to send",
          "mappable": true
        }
      ],
      "interface": [
        {
          "name": "packetEid",
          "label": "Packet ID",
          "type": "text"
        },
        {
          "name": "name",
          "label": "Packet Name",
          "type": "text"
        },
        {
          "name": "status",
          "label": "Status",
          "type": "text"
        },
        {
          "name": "isDraft",
          "label": "Is Draft",
          "type": "boolean"
        },
        {
          "name": "createdAt",
          "label": "Created At",
          "type": "date"
        },
        {
          "name": "documentGroup",
          "label": "Document Group",
          "type": "collection",
          "spec": [
            {
              "name": "eid",
              "type": "text"
            },
            {
              "name": "status",
              "type": "text"
            }
          ]
        }
      ]
    },
    {
      "name": "downloadDocuments",
      "label": "Download Documents",
      "description": "Get download URLs for all documents from a signature packet or workflow",
      "type": "action",
      "connection": "anvil",
      "communication": {
        "url": "https://graphql.useanvil.com",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
        },
        "body": {
          "query": "query DocumentGroup($eid: String!) { documentGroup(eid: $eid) { eid status downloadZipURL files { eid filename title downloadUrl } } }",
          "variables": {
            "eid": "{{parameters.documentGroupEid}}"
          }
        },
        "response": {
          "output": {
            "documentGroupEid": "{{body.data.documentGroup.eid}}",
            "status": "{{body.data.documentGroup.status}}",
            "downloadZipURL": "{{body.data.documentGroup.downloadZipURL}}",
            "files": "{{body.data.documentGroup.files}}"
          },
          "error": {
            "message": "{{if(body.errors; body.errors[0].message; 'Failed to get document download URLs')}}"
          }
        },
        "log": {
          "sanitize": [
            "request.headers.Authorization"
          ]
        }
      },
      "parameters": [
        {
          "name": "documentGroupEid",
          "label": "Document Group ID",
          "type": "text",
          "required": true,
          "help": "The EID of the DocumentGroup",
          "mappable": true
        }
      ],
      "interface": [
        {
          "name": "documentGroupEid",
          "label": "Document Group ID",
          "type": "text"
        },
        {
          "name": "status",
          "label": "Status",
          "type": "text"
        },
        {
          "name": "downloadZipURL",
          "label": "Download ZIP URL",
          "type": "url"
        },
        {
          "name": "files",
          "label": "Files",
          "type": "array",
          "spec": {
            "type": "collection",
            "spec": [
              {
                "name": "eid",
                "label": "File ID",
                "type": "text"
              },
              {
                "name": "filename",
                "label": "Filename",
                "type": "text"
              },
              {
                "name": "title",
                "label": "Title",
                "type": "text"
              },
              {
                "name": "downloadUrl",
                "label": "Download URL",
                "type": "url"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "listWorkflows",
      "label": "List Workflows",
      "description": "Retrieve a list of all Workflows (Welds) in your organization",
      "type": "search",
      "connection": "anvil",
      "communication": {
        "url": "https://graphql.useanvil.com",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
        },
        "body": {
          "query": "query { currentUser { organizations { eid name slug welds { eid title slug name isArchived createdAt forges { eid name slug } } } } }"
        },
        "response": {
          "iterate": "{{body.data.currentUser.organizations[0].welds}}",
          "output": {
            "eid": "{{item.eid}}",
            "title": "{{item.title}}",
            "name": "{{item.name}}",
            "slug": "{{item.slug}}",
            "isArchived": "{{item.isArchived}}",
            "createdAt": "{{item.createdAt}}",
            "forges": "{{item.forges}}"
          },
          "error": {
            "message": "{{if(body.errors; body.errors[0].message; 'Failed to list workflows')}}"
          }
        },
        "log": {
          "sanitize": [
            "request.headers.Authorization"
          ]
        }
      },
      "parameters": [],
      "interface": [
        {
          "name": "eid",
          "label": "Workflow ID",
          "type": "text"
        },
        {
          "name": "title",
          "label": "Title",
          "type": "text"
        },
        {
          "name": "name",
          "label": "Name",
          "type": "text"
        },
        {
          "name": "slug",
          "label": "Slug",
          "type": "text"
        },
        {
          "name": "isArchived",
          "label": "Is Archived",
          "type": "boolean"
        },
        {
          "name": "createdAt",
          "label": "Created At",
          "type": "date"
        },
        {
          "name": "forges",
          "label": "Webforms",
          "type": "array",
          "spec": {
            "type": "collection",
            "spec": [
              {
                "name": "eid",
                "type": "text"
              },
              {
                "name": "name",
                "type": "text"
              },
              {
                "name": "slug",
                "type": "text"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "getWorkflowData",
      "label": "Get Workflow Data",
      "description": "Retrieve data and status from a workflow submission",
      "type": "action",
      "connection": "anvil",
      "communication": {
        "url": "https://graphql.useanvil.com",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
        },
        "body": {
          "query": "query WeldData($eid: String!) { weldData(eid: $eid) { eid isTest status continueURL displayTitle numberRemainingSigners dataUpdatedAt submissions { eid status resolvedPayload forge { eid name slug } } documentGroup { eid status downloadZipURL currentRoutingStep signers { eid status name email routingOrder } } } }",
          "variables": {
            "eid": "{{parameters.weldDataEid}}"
          }
        },
        "response": {
          "output": {
            "weldDataEid": "{{body.data.weldData.eid}}",
            "isTest": "{{body.data.weldData.isTest}}",
            "status": "{{body.data.weldData.status}}",
            "continueURL": "{{body.data.weldData.continueURL}}",
            "displayTitle": "{{body.data.weldData.displayTitle}}",
            "numberRemainingSigners": "{{body.data.weldData.numberRemainingSigners}}",
            "dataUpdatedAt": "{{body.data.weldData.dataUpdatedAt}}",
            "submissions": "{{body.data.weldData.submissions}}",
            "documentGroup": "{{body.data.weldData.documentGroup}}"
          },
          "error": {
            "message": "{{if(body.errors; body.errors[0].message; 'Failed to get workflow data')}}"
          }
        },
        "log": {
          "sanitize": [
            "request.headers.Authorization"
          ]
        }
      },
      "parameters": [
        {
          "name": "weldDataEid",
          "label": "Workflow Data ID",
          "type": "text",
          "required": true,
          "help": "The EID of the workflow submission (WeldData)",
          "mappable": true
        }
      ],
      "interface": [
        {
          "name": "weldDataEid",
          "label": "Workflow Data ID",
          "type": "text"
        },
        {
          "name": "isTest",
          "label": "Is Test",
          "type": "boolean"
        },
        {
          "name": "status",
          "label": "Status",
          "type": "text"
        },
        {
          "name": "continueURL",
          "label": "Continue URL",
          "type": "url"
        },
        {
          "name": "displayTitle",
          "label": "Display Title",
          "type": "text"
        },
        {
          "name": "numberRemainingSigners",
          "label": "Remaining Signers",
          "type": "integer"
        },
        {
          "name": "dataUpdatedAt",
          "label": "Data Updated At",
          "type": "date"
        },
        {
          "name": "submissions",
          "label": "Submissions",
          "type": "array",
          "spec": {
            "type": "collection",
            "spec": [
              {
                "name": "eid",
                "type": "text"
              },
              {
                "name": "status",
                "type": "text"
              },
              {
                "name": "resolvedPayload",
                "type": "collection"
              },
              {
                "name": "forge",
                "type": "collection",
                "spec": [
                  {
                    "name": "eid",
                    "type": "text"
                  },
                  {
                    "name": "name",
                    "type": "text"
                  }
                ]
              }
            ]
          }
        },
        {
          "name": "documentGroup",
          "label": "Document Group",
          "type": "collection",
          "spec": [
            {
              "name": "eid",
              "type": "text"
            },
            {
              "name": "status",
              "type": "text"
            },
            {
              "name": "downloadZipURL",
              "type": "url"
            },
            {
              "name": "currentRoutingStep",
              "type": "integer"
            }
          ]
        }
      ]
    },
    {
      "name": "generatePdfFromHtml",
      "label": "Generate PDF from HTML",
      "description": "Generate a PDF document from HTML and CSS content",
      "type": "action",
      "connection": "anvil",
      "communication": {
        "url": "https://graphql.useanvil.com",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
        },
        "body": {
          "query": "mutation GeneratePdf($data: GeneratePdfInput!) { generatePdf(data: $data) { file downloadUrl } }",
          "variables": {
            "data": {
              "data": {
                "html": "{{parameters.html}}",
                "css": "{{parameters.css}}"
              },
              "title": "{{parameters.title}}",
              "type": "html"
            }
          }
        },
        "response": {
          "output": {
            "file": "{{body.data.generatePdf.file}}",
            "downloadUrl": "{{body.data.generatePdf.downloadUrl}}",
            "title": "{{parameters.title}}"
          },
          "error": {
            "message": "{{if(body.errors; body.errors[0].message; 'Failed to generate PDF')}}"
          }
        },
        "log": {
          "sanitize": [
            "request.headers.Authorization"
          ]
        }
      },
      "parameters": [
        {
          "name": "html",
          "label": "HTML Content",
          "type": "text",
          "required": true,
          "help": "HTML content for the PDF",
          "mappable": true
        },
        {
          "name": "css",
          "label": "CSS Styles",
          "type": "text",
          "required": false,
          "help": "CSS styles to apply to the HTML content",
          "advanced": true,
          "mappable": true
        },
        {
          "name": "title",
          "label": "Document Title",
          "type": "text",
          "required": false,
          "help": "Title for the generated PDF",
          "mappable": true
        }
      ],
      "interface": [
        {
          "name": "file",
          "label": "PDF File (Base64)",
          "type": "text"
        },
        {
          "name": "downloadUrl",
          "label": "Download URL",
          "type": "url"
        },
        {
          "name": "title",
          "label": "Document Title",
          "type": "text"
        }
      ]
    },
    {
      "name": "makeApiCall",
      "label": "Make an API Call",
      "description": "Perform an arbitrary API call to the Anvil API",
      "type": "universal",
      "connection": "anvil",
      "parameters": [
        {
          "name": "endpoint",
          "label": "Endpoint",
          "type": "select",
          "required": true,
          "default": "rest",
          "options": [
            {
              "label": "REST API",
              "value": "rest"
            },
            {
              "label": "GraphQL API",
              "value": "graphql"
            }
          ]
        },
        {
          "name": "method",
          "label": "HTTP Method",
          "type": "select",
          "required": true,
          "default": "GET",
          "options": [
            {
              "label": "GET",
              "value": "GET"
            },
            {
              "label": "POST",
              "value": "POST"
            },
            {
              "label": "PUT",
              "value": "PUT"
            },
            {
              "label": "PATCH",
              "value": "PATCH"
            },
            {
              "label": "DELETE",
              "value": "DELETE"
            }
          ]
        },
        {
          "name": "path",
          "label": "URL Path",
          "type": "text",
          "required": true,
          "help": "The path to append to the base URL",
          "mappable": true
        },
        {
          "name": "queryString",
          "label": "Query String",
          "type": "collection",
          "required": false,
          "help": "Query parameters as key-value pairs",
          "advanced": true,
          "mappable": true
        },
        {
          "name": "body",
          "label": "Request Body",
          "type": "json",
          "required": false,
          "help": "JSON body for POST/PUT/PATCH requests",
          "mappable": true
        }
      ],
      "communication": {
        "url": "{{if(parameters.endpoint === 'graphql'; 'https://graphql.useanvil.com'; 'https://app.useanvil.com/api/v1' + parameters.path)}}",
        "method": "{{parameters.method}}",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
        },
        "qs": "{{parameters.queryString}}",
        "body": "{{parameters.body}}",
        "response": {
          "output": "{{body}}",
          "error": {
            "message": "{{if(body.errors; body.errors[0].message; if(body.error; body.error; 'API request failed'))}}"
          }
        },
        "log": {
          "sanitize": [
            "request.headers.Authorization"
          ]
        }
      },
      "interface": []
    }
  ]
}
