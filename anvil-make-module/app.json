{
  "name": "anvil",
  "label": "Anvil",
  "version": "1.0.0",
  "description": "Anvil API integration for PDF filling, generation, e-signatures, and document workflows. Automate document processes with Anvil's powerful API.",
  "beta": false,
  "moduleConfig": {
    "limit": 100
  },
  "baseUrl": "https://app.useanvil.com/api/v1",
  "connection": {
    "label": "Anvil API Key",
    "type": "api-key",
    "parameters": [
      {
        "name": "apiKey",
        "type": "password",
        "label": "API Key",
        "required": true,
        "help": "Your Anvil API key. Find it at Organization Settings > API Settings. Use production key for live data or development key for testing.",
        "editable": true
      },
      {
        "name": "environment",
        "type": "select",
        "label": "Environment",
        "required": true,
        "default": "production",
        "options": [
          {
            "label": "Production",
            "value": "production"
          },
          {
            "label": "Development",
            "value": "development"
          }
        ],
        "help": "Production key for live data, Development key for testing (watermarked PDFs, stricter rate limits)"
      }
    ],
    "communication": {
      "url": "https://graphql.useanvil.com",
      "method": "POST",
      "headers": {
        "Authorization": "Basic {{base64(parameters.apiKey + ':')}}",
        "Content-Type": "application/json"
      },
      "body": {
        "query": "{ currentUser { eid email name } }"
      },
      "response": {
        "valid": "{{statusCode === 200 && body.data.currentUser}}",
        "metadata": {
          "userEmail": "{{body.data.currentUser.email}}",
          "userName": "{{body.data.currentUser.name}}",
          "environment": "{{parameters.environment}}"
        },
        "error": {
          "message": "{{if(body.errors; body.errors[0].message; 'Authentication failed. Please check your API key.')}}"
        }
      },
      "log": {
        "sanitize": [
          "request.headers.Authorization"
        ]
      }
    }
  },
  "base": {
    "baseUrl": "https://app.useanvil.com/api/v1",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Basic {{base64(connection.apiKey + ':')}}"
    },
    "response": {
      "error": {
        "message": "{{if(body.errors; body.errors[0].message; if(body.error; body.error; if(body.message; body.message; 'Request failed')))}}",
        "type": "{{if(statusCode === 401; 'AuthenticationError'; if(statusCode === 403; 'AuthorizationError'; if(statusCode === 429; 'RateLimitError'; if(statusCode >= 500; 'ConnectionError'; 'DataError'))))}}"
      }
    },
    "log": {
      "sanitize": [
        "request.headers.Authorization"
      ]
    }
  },
  "webhooks": [
    {
      "name": "etchComplete",
      "label": "E-Signature Complete",
      "type": "dedicated"
    },
    {
      "name": "signerComplete",
      "label": "Signer Complete",
      "type": "dedicated"
    },
    {
      "name": "workflowComplete",
      "label": "Workflow Complete",
      "type": "dedicated"
    }
  ],
  "modules": [
    {
      "name": "fillPdfTemplate",
      "label": "Fill a PDF Template",
      "description": "Fill a PDF template with data and return the filled PDF as a file",
      "type": "action"
    },
    {
      "name": "generatePdfHtml",
      "label": "Generate PDF from HTML",
      "description": "Generate a PDF document from HTML and CSS content",
      "type": "action"
    },
    {
      "name": "generatePdfMarkdown",
      "label": "Generate PDF from Markdown",
      "description": "Generate a PDF document from Markdown content with tables and styled sections",
      "type": "action"
    },
    {
      "name": "createEtchPacket",
      "label": "Create an E-Signature Packet",
      "description": "Create an e-signature packet with PDFs and signers",
      "type": "action"
    },
    {
      "name": "getEtchPacket",
      "label": "Get E-Signature Status",
      "description": "Retrieve the current status of an e-signature packet",
      "type": "action"
    },
    {
      "name": "sendEtchPacket",
      "label": "Send an E-Signature Packet",
      "description": "Send a draft e-signature packet to its signers",
      "type": "action"
    },
    {
      "name": "generateSignerUrl",
      "label": "Generate Signer URL",
      "description": "Generate a signing URL for an embedded signer",
      "type": "action"
    },
    {
      "name": "downloadEtchDocuments",
      "label": "Download Signed Documents",
      "description": "Get download URLs for signed documents from an e-signature packet",
      "type": "action"
    },
    {
      "name": "createWorkflowSubmission",
      "label": "Create Workflow Submission",
      "description": "Start a new workflow submission with data to fill forms and PDFs",
      "type": "action"
    },
    {
      "name": "getWorkflowData",
      "label": "Get Workflow Data",
      "description": "Retrieve data and status from a workflow submission",
      "type": "action"
    },
    {
      "name": "listPdfTemplates",
      "label": "List PDF Templates",
      "description": "Retrieve a list of all PDF templates in your organization",
      "type": "search"
    },
    {
      "name": "getTemplateFields",
      "label": "Get Template Fields",
      "description": "Retrieve all fillable fields from a PDF template",
      "type": "search"
    },
    {
      "name": "listWorkflows",
      "label": "List Workflows",
      "description": "Retrieve a list of all Workflows in your organization",
      "type": "search"
    },
    {
      "name": "watchEtchComplete",
      "label": "Watch E-Signature Complete",
      "description": "Triggers when all signers have completed signing",
      "type": "trigger"
    },
    {
      "name": "watchSignerComplete",
      "label": "Watch Signer Complete",
      "description": "Triggers when a signer finishes signing",
      "type": "trigger"
    },
    {
      "name": "watchWorkflowComplete",
      "label": "Watch Workflow Complete",
      "description": "Triggers when a workflow completes",
      "type": "trigger"
    },
    {
      "name": "makeGraphQLQuery",
      "label": "Execute GraphQL Query",
      "description": "Execute a custom GraphQL query or mutation",
      "type": "universal"
    }
  ]
}
